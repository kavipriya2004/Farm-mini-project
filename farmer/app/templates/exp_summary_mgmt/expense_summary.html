<!DOCTYPE html>
<html>

<head>
    <title>Expense Summary</title>
    <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #343a40;
        }

        a {
            display: inline-block;
            margin-top: 10px;
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            text-decoration: none;
            border-radius: 4px;
        }

        p {
            margin-top: 20px;
            font-size: 18px;
            color: #555;
        }

        canvas {
            margin-top: 20px;
            max-width: 100%;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>

    <h1>Expense Summary</h1>

    <!-- Add a link to the detailed reports page -->
    <a href="{% url 'app:detailed_reports' %}">Detailed Expense Reports</a>

    <!-- Display total expenses, average expenses, and other metrics -->
    <p>Total Expenses: {{ total_expenses }}</p>
    <p>Average Expenses: {{ average_expenses }}</p>
    <!-- Add other high-level metrics -->

    <!-- Bar chart for expenses by type -->
    <canvas id="expensesByTypeChart" width="400" height="200"></canvas>

    <!-- Pie chart for expense distribution -->
    <canvas id="expenseDistributionChart" width="400" height="200"></canvas>

    <script>
        // JavaScript code to create and update charts using Chart.js
        document.addEventListener('DOMContentLoaded', function () {
            // Get data from Django context
            var expenseTypes = {{ expense_types|safe }};
            var expensesByType = {{ expenses_by_type|safe }};
            var expenseDistribution = {{ expense_distribution|safe }};

            // Convert expensesByType to an array of floats
            var expensesByTypeData = expensesByType.map(parseFloat);

            // Bar chart for expenses by type
            var ctxExpensesByType = document.getElementById('expensesByTypeChart').getContext('2d');
            var expensesByTypeChart = new Chart(ctxExpensesByType, {
                type: 'bar',
                data: {
                    labels: expenseTypes,
                    datasets: [{
                        label: 'Expenses by Type',
                        data: expensesByTypeData,  // Use the converted array here
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                }
            });

            // Pie chart for expense distribution
            var ctxExpenseDistribution = document.getElementById('expenseDistributionChart').getContext('2d');
            var expenseDistributionChart = new Chart(ctxExpenseDistribution, {
                type: 'pie',
                data: {
                    labels: expenseTypes,
                    datasets: [{
                        data: expenseDistribution,
                        backgroundColor: ['red', 'blue', 'green', 'yellow', 'purple', 'orange']
                    }]
                }
            });
        });
    </script>

</body>

</html>
